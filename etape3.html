<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Rêvons en grand</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --muted:#6b7280; --accent:#ff6b4a; --bg:#fffaf0;
    --card:#ffffff; --shadow: rgba(16,24,40,0.06);
  }
  *{box-sizing:border-box;}
  body{
    font-family:Inter,system-ui,Arial,sans-serif;
    background:var(--bg);
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:18px;
  }
  .card{
    width:100%;
    max-width:680px;
    background:var(--card);
    border-radius:14px;
    padding:24px;
    box-shadow:0 10px 30px var(--shadow);
    text-align:center;
  }
  h2{margin:0 0 16px;font-weight:600;font-size:24px;color:#1f2937;}
  p{margin-bottom:16px;color:#374151;line-height:1.5;}
  .status{
    margin-top:16px;
    padding:12px;
    border-radius:8px;
    font-weight:600;
    display:none;
  }
  .status.active{display:block;}
  .status.ok{background:#d1fae5;color:#065f46;}
  .status.bad{background:#fee2e2;color:#991b1b;}
  img.qr{max-width:80%;margin-top:20px;border-radius:12px;}
</style>
</head>
<body>
  <div class="card">
    <h2>Rêvons en grand</h2>
    <p>Le lieu est vaste, traversé de voyageurs et plein d’adieux.<br>
    Peut-être y trouveras-tu la suite du chemin, là où l’on s’est souvent disputé.</p>

    <div id="status" class="status"></div>
    <div id="qrContainer">
      <p>Approche-toi de l’endroit pour voir si quelque chose se révèle.</p>
    </div>
  </div>

<script>
// Coordonnées : Miniso - Gare Montparnasse
const TARGET_LAT = 48.8414794;
const TARGET_LON = 2.3191836;
const GEO_RADIUS = 60; // mètres

function distanceMeters(lat1, lon1, lat2, lon2){
  const R = 6371000;
  const toRad = a => a * Math.PI / 180;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function setStatus(text, cls){
  const s = document.getElementById('status');
  s.textContent = text;
  s.className = 'status active ' + (cls||'');
}

function showQRCode(){
  const qrContainer = document.getElementById('qrContainer');
  qrContainer.innerHTML = `
    <p><strong>C’est un peu petit non ?</strong><br>
    Que dirais-tu de 800 m² rien que pour nous ?</p>
    <img class="qr" src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=https%3A%2F%2Fmaps.app.goo.gl%2FCkjuoNqau5zYmqrNA" alt="QR code secret"/>
  `;
  setStatus('L’indice est révélé !', 'ok');
}

if('geolocation' in navigator){
  navigator.geolocation.watchPosition(pos => {
    const d = distanceMeters(pos.coords.latitude, pos.coords.longitude, TARGET_LAT, TARGET_LON);
    if(d <= GEO_RADIUS) showQRCode();
    else setStatus(`Tu sembles à ${Math.round(d)} m du bon endroit...`, '');
  }, err => {
    const messages = {
      1: 'Autorise la localisation pour continuer.',
      2: 'Position introuvable. Vérifie ton GPS.',
      3: 'Temps écoulé. Réessaie.'
    };
    setStatus(messages[err.code] || 'Erreur inconnue.', 'bad');
  }, { enableHighAccuracy:true, maximumAge:3000, timeout:20000 });
} else {
  setStatus('Ton appareil ne supporte pas la géolocalisation.', 'bad');
}
</script>
</body>
</html>

